# SalesForce

## SalesForce ä»‹ç»

+ æœ‰è¾ƒå¤šæ¨¡å—ï¼Œéœ€è¦ä»˜è´¹
+ æœ‰è‡ªåŠ¨ç¿»è¯‘åŠŸèƒ½ï¼Œä½†è‡ªå®šä¹‰çš„å˜é‡éœ€è¦æ‰‹åŠ¨ç¿»è¯‘ 
+ æ— éœ€å®‰è£…ï¼Œæ˜¾ç¤ºæŠ¥è¡¨ä¸å›¾è¡¨ï¼Œæå‡æ•ˆç‡å¤§
+ å®‰å…¨æ€§é«˜
+ æä¾›å”®åæ”¯æŒï¼Œå¯ä»¥æé—®é¢˜

> lightingæ¨¡å¼ï¼šç°ä»Šä¸»è¦é‡‡ç”¨è¯¥æ¨¡å¼
>
> classicæ¨¡å¼ï¼š

## SalesForceæœ¯è¯­

+ å¯¹è±¡ï¼šå…·æœ‰ç‰¹å®šæ•°æ®ç±»å‹çš„å±æ€§ï¼Œå±æ€§ä¸æ•°æ®åº“è¡¨ä¸­çš„åˆ—å­—æ®µç›¸ä¼¼
+ + æ ‡å‡†å¯¹è±¡
  + è‡ªå®šä¹‰å¯¹è±¡ï¼šæœ‰==__c==(custom)ä½œä¸ºåç¼€
+ å·¥ä½œæµï¼šä¸€ç»„é€»è¾‘è§„åˆ™ï¼šåœ¨ç‰¹å®šçš„è§¦å‘èŠ‚ç‚¹ï¼Œè¿›è¡Œä¸€äº›æ“ä½œ
+ å­—æ®µï¼šå¯¹è±¡çš„ä¸€ä¸ªå±æ€§ï¼›åº“é‡Œçš„ä¸€ä¸ªè¡¨ï¼›å­˜åœ¨å¤§é‡é»˜è®¤å­—æ®µæœªæ˜¾ç¤º
+ è§’è‰²ï¼šå·¥ä½œèŒä½ï¼Œæœ‰ä¸Šä¸‹çº§ã€åŒçº§å…³ç³»ï¼›åœ¨å‰æœŸé˜¶æ®µå°±è¦ä¸å®¢æˆ·ç¡®å®šå¥½ï¼ˆæ ‘å½¢ç»“æ„ï¼Œä¸Šçº§å¯ä»¥æµè§ˆä¸‹çº§çš„è®°å½•ï¼‰ï¼ˆæ§åˆ¶ç”¨æˆ·çš„è®¿é—®æƒé™ï¼‰
+ ç®€æ¡£ï¼šå®šä¹‰ç”¨æˆ·å¯ä»¥æ‰§è¡Œçš„ä»»åŠ¡ï¼›ä»–ä»¬å¯ä»¥çœ‹åˆ°çš„æ•°æ®ï¼›ä»–ä»¬å¯¹æ•°æ®çš„æ“ä½œæƒæƒé™(æ§åˆ¶ç”¨æˆ·çš„æ“ä½œæƒé™)
+ æ´»åŠ¨ï¼šç³»ç»Ÿæ ‡å‡†çš„å¯¹è±¡
+ è®°å½•ï¼šå­˜å‚¨æœ‰å…³ç‰¹å®šé¡¹ç›®çš„æ‰€æœ‰ä¿¡æ¯
+ è§†å›¾ï¼šè®°å½•åˆ—è¡¨ç­›é€‰å™¨
+ é¡µé¢å­—æ®µå‰å¸¦ï¼šå¿…å¡«é¡¹çš„æ ‡è¯†
+ æŠ¥è¡¨ï¼šæ•°æ®å±•ç¤º
+ ä»ªè¡¨ç›˜ï¼šæ•°æ®å±•ç¤º
+ å›æ”¶ç«™ï¼šæš‚å­˜æœ€è¿‘åˆ é™¤çš„æ•°æ®ï¼Œæœ‰å®¹é‡çš„é™åˆ¶
+ è‡ªå®šä¹‰åŠŸèƒ½ï¼šé€šè¿‡SalesForceçš„è‡ªå®šä¹‰å¹³å°å¯ä»¥å¿«é€Ÿè‡ªå»ºæ¨¡å—ç­‰ç­‰
+ äº‘è®¡ç®—ï¼šäº‘ç«¯ç¼–è¯‘ä¸æ•°æ®å¤„ç†
+ åˆ†æ´¾ï¼šå°†Ownerä¸ºè‡ªå·±çš„è®°å½•assignç»™å…¶ä»–äººå‘˜ï¼Œæ›´æ”¹â€œæ‰€æœ‰äººâ€
+ æœç´¢ï¼šæ¨¡å—å†…ç²¾ç¡®æœç´¢ä¸å…¨å±€æœç´¢
+ è¯»å–ï¼šæŸ¥çœ‹ä¿¡æ¯
+ ç¼–è¾‘ï¼šæœ‰æƒé™å°±å¯å¯¹æ•°æ®è¿›è¡Œç¼–è¾‘æ“ä½œ
+ å…±äº«ï¼šå…è®¸å…¶ä»–ç”¨æˆ·æŸ¥çœ‹æˆ–ç¼–è¾‘æ‚¨æ‹¥æœ‰çš„ä¿¡æ¯
+ + å…±äº«æ¨¡å¼ï¼šå®šä¹‰ç”¨æˆ·å¯¹ç›¸äº’ä¹‹é—´çš„ä¿¡æ¯æ‹¥æœ‰çš„é»˜è®¤ç»„ç»‡èŒƒå›´è®¿é—®æƒé™çº§åˆ«ï¼›åœ¨ç¡®å®šå¯¹æ•°æ®çš„è®¿é—®æƒé™æ—¶æ˜¯å¦ä½¿ç”¨å±‚æ¬¡ç»“æ„
  + è§’è‰²å±‚æ¬¡ç»“æ„ï¼šä¸Šä¸‹çº§çš„ä¸åŒæƒé™è®¾ç½®ï¼ˆä¸Šå±‚å¯ä»¥çœ‹åˆ°ä¸‹å±‚ï¼‰
+ else

## å¯¹è±¡

+ å­—æ®µ
+ + ä¸»è¯¦ç»†å…³ç³»ï¼šç›¸å½“äºæ•°æ®åº“ä¸­çš„ä¸»é”®
  + æŸ¥æ‰¾å…³ç³»ï¼šå¼±ä¸€çº§çš„ä¸»é”®ï¼Œä¸»è®°å½•è¢«åˆ é™¤å­è®°å½•æ— å½±å“
+ æ–‡æœ¬åŒºï¼šå…è®¸è¾“å…¥æ ¼å¼åŒ–æ–‡æœ¬ã€é“¾æ¥å’Œå›¾ç‰‡
+ è®°å½•ç±»å‹ï¼š

## å·¥ä½œæµè§„åˆ™



ä¸€æ¡è®°å½•å ç”¨2KB



# Day2(06-21)

+ åœ¨é¡µé¢ä¸Šé€‰æ‹©â€å¿…å¡«â€œï¼Œä¸åœ¨å­—æ®µä¸­è®¾ç½®ä¸ºâ€å¿…å¡«â€œï¼ˆä¸¥æ ¼ï¼Œå¯¼å…¥æ—¶æ˜“æŠ¥é”™ï¼‰

+ é¢ä¸€ä¸ªè®°å½•ç±»å‹å’Œç®€æ¡£éƒ½å¯¹åº”ä¸€ä¸ªé¡µé¢å¸ƒå±€

+ æµæ“ä½œæ— æ³•å–æ¶ˆæ¿€æ´»ï¼Œè‹¥è¦æ›´æ”¹éœ€è¦å¦å­˜ä¸ºå†æ¿€æ´»
+ Integer Stringi = integer.valueof("1111");

+ã€€è·¨å¯¹è±¡æŸ¥è¯¢ï¼Œä¸€æ¬¡æŸ¥è¯¢å¤šä¸ªå¯¹è±¡ï¼Œæœ€å¤§è¿”å›2000æ¡æ•°æ®

```APEX
String SOSL = 'FIND {' + 'æµ‹è¯•å®¢æˆ·' + ' OR ' + 'Test' + '} IN Name Fields RETURNING Account(name,phone),Contact(name,phone)';
List<List<SObject>> searchList = search.query(SOSL);
system.debug(searchList);
```

+ æ·»åŠ æ•°æ®

```APEX
List<Account> acctList = new List<Account>();
acctlist.add(new Account(Name='Sales User1'));
Insert acctlist;
```

+ã€€æ›´æ–°æ•°æ®

```APEX
List<Account> acctList = [SELECT Id,Name FROM Account where id='0015g00000GQVPbAAP'];
for(Account acc:acctList){
    acc.Name = 'Update Sales User1';
}
Update acctList;
```

+ æ•°æ®åº“æ“ä½œè¿”å›ç»“æœ

```
List<Account> accountList = new List<Account>();
accountList.add(new Account(Name = 'Sales User 2'));
Database.SaveResult[] saveResult = Database.Insert(accountList,FALSE);
for(Database.SaveResult result : saveResult){
    if(result.isSuccess()){
        System.debug(LoggingLevel.INFO, '*** result.getId():' + result.getId());
    }else{
        System.debug(LoggingLevel.INFO, '*** result.getErrors():' + result.getErrors());
    }
}
```

+ æ•°æ®åº“äº‹åŠ¡ä¿å­˜ç‚¹

```
Savepoint savePoint = Database.setSavepoint();
Database.rollback(savePoint);
```

+ å…³è”æŸ¥è¯¢

```
List<Account> accountList = [SELECT Id
                             , name
                             , ParentId
                             , Parent.ParentId
                             , Parent.Parent.ParentId
                             , Parent.Parent.Parent.ParentId
                             , Parent.Parent.Parent.Parent.ParentId
                             FROM Account];
System.debug(LoggingLevel.INFO, '*** accountList:' + accountList);

List<OrderDetails__c> orderDetailList = [SELECT Id
                                         , Name
                                         , Quantity__c
                                         , customOrder__r.Name
                                         , customOrder__r.remarks__c
                                         , customOrder__r.account__r.Name
                                        FROM OrderDateils__c];
System.debug(LoggingLevel.INFO, '***orderDetailsList: ' + orderDetailsList);
```

+ è‡ªå®šä¹‰æ§åˆ¶å™¨çš„ä½¿ç”¨

  myFirstCtrl.cls

  ```
  public class myFirstCtrl {
      public List<Account> accList {get;set;}
  
      public myFirstCtrl(ApexPages.StandardController con){
          accList = [SELECT Id,Name FROM Account LIMIT 10];
      }
  }
  ```

  MyFirstPage.page

  ```
  public class myFirstCtrl {
      public List<Account> accList {get;set;}
  
      public myFirstCtrl(ApexPages.StandardController con){
          accList = [SELECT Id,Name FROM Account LIMIT 10];
      }
  }
  ```

  ## Day3(06-22)

  

before update:ä¿®æ”¹è‡ªèº«

after update:æ›´æ–°ä¸€ä¸ªå…¶ä»–å¯¹è±¡ï¼Œæ˜¯ä¸ªè¿‡ç¨‹





## Day4(07-01)

#### halper.jså¦‚ä½•è°ƒç”¨åå°æ–¹æ³•

1.APEXæ–¹æ³•å®ä¾‹ç”³æ˜

2.è®¾ç½®å‚æ•°

3.è®¾ç½®å›è°ƒå‡½æ•°

4.æ’é˜Ÿ

#### äº¤äº’

çˆ¶->å­ï¼šå±æ€§

component;å­->çˆ¶

applicationï¼šåº”ç”¨çº§åˆ«çš„æ‰€æœ‰çš„éƒ½å¯æ¥æ”¶ï¼ˆè€—èµ„æºï¼‰



1. + å­ï¼šæ³¨å†Œï¼Œçˆ¶ï¼šå£°æ˜å¤„ç†äº‹ä»¶
   + æ³¨å†Œï¼šcompent **name** type
   + å¤„ç† ï¼š                **name** type action
   + application ä¸ç”¨åœ¨å¤„ç†ä¸­ä¸€å®šæœ‰ **name**

# lightning

1.appliciationEvent åº”ç”¨äº‹ä»¶

+ å­ç»„ä»¶å‘å‡ºï¼Œæ‰€æœ‰ç»„ä»¶éƒ½å¯ä»¥æ¥æ”¶åˆ°
+ è€—èµ„æº

2.componentEvent ç»„ä»¶äº‹ä»¶

+ åªå¯ç”¨äºå­ç»„ä»¶å‘çˆ¶ç»„ä»¶å‘å‡º

# Trigger

### åˆ†ç±»

+ ä»¥æ‰§è¡Œé¡ºåºåˆ†ç±»æœ‰ï¼šbeforeï¼ˆä¿å­˜ä¹‹å‰ï¼‰ï¼Œafterï¼ˆä¿å­˜ä¹‹åï¼‰
+ ä»¥DMLç±»å‹ï¼ˆæ•°æ®æ“ä½œç±»å‹ï¼‰æœ‰ï¼šinsertï¼ˆæ–°å¢ï¼‰ã€updateï¼ˆæ›´æ–°ï¼‰ã€deleteï¼ˆåˆ é™¤ï¼‰ã€undeleteï¼ˆæ¢å¤åˆ é™¤ï¼‰

### å±æ€§

+ isInsertï¼šå½“å‰æ“ä½œæ˜¯å¦æ­£åœ¨æ‰§è¡Œ**æ·»åŠ **æ“ä½œ
+ isUpdateï¼šå½“å‰æ“ä½œæ˜¯å¦æ­£åœ¨æ‰§è¡Œ**ä¿®æ”¹**æ“ä½œ
+ isDeleteï¼šå½“å‰æ“ä½œæ˜¯å¦æ­£åœ¨æ‰§è¡Œ**åˆ é™¤**æ“ä½œ
+ isUndeleteï¼šå½“å‰æ“ä½œæ˜¯å¦ä¸º**åœ¨å›æ”¶ç®±ä¸­å›å¤æ•°æ®ä»¥å**æ“ä½œ
+ isBeforeï¼šå½“å‰æ“ä½œæ˜¯å¦ä¸º**åœ¨saveä»¥å‰**æ“ä½œ
+ isAfterï¼šå½“å‰æ“ä½œæ˜¯å¦ä¸º**åœ¨saveä»¥å**æ“ä½œ
+ **ä¸æ”¯æŒBeforeUndeleteæ“ä½œ**
+ newï¼šè¿”å›sObjectçš„è®°å½•çš„æœ€æ–°çš„æ•°æ®çš„åˆ—è¡¨
+ newMapï¼šè¿”å›ä¸€ä¸ªIDæ˜ å°„æœ€æ–°çš„æ•°æ®åˆ—è¡¨çš„Mapé›†åˆ
+ oldï¼šè¿”å›sObjectçš„è®°å½•ä¿®æ”¹ä»¥å‰çš„æ•°æ®çš„åˆ—è¡¨
+ oldMapï¼šè¿”å›ä¸€ä¸ªIDæ˜ å°„åˆ°ä»¥å‰çš„æ•°æ®åˆ—è¡¨çš„Mapé›†åˆ
+ Trigger.newï¼šé€‚ç”¨äºæ‰§è¡Œinsertå’Œupdateçš„triggeræ“ä½œæ—¶å¹¶ä¸”ç±»å‹ä¸ºbeforeçš„æ—¶å€™
+ Trigger.newMap:é€‚ç”¨äºæ‰§è¡Œbefore updateï¼Œafter insertä»¥åŠafter updateçš„triggeræ“ä½œ
+ Trigger.oldä»¥åŠTrigger.oldMapé€‚ç”¨äºupdateå’Œdeleteæ“ä½œ

# æ‰¹å¤„ç†

åº”ç”¨åœºæ™¯ï¼šå¤§æ•°æ®é‡çš„DMLæ“ä½œæˆ–æŸ¥è¯¢æ“ä½œï¼Œå¦‚æŸ¥è¯¢æ•°æ®é‡è¶…è¿‡50000ã€æ–°å¢ã€ä¿®æ”¹å’Œåˆ é™¤çš„æ•°æ®é‡è¶…è¿‡10000æ—¶

### è¯­æ³•

1.å®ç°Datebase.Batchableã€Database.Statefulæ¥å£

2.å®ç°Database.Batchableæ¥å£çš„startæ–¹æ³•ã€excuteæ–¹æ³•ã€finashæ–¹æ³•

## Tips

1.å‘å¯¹è±¡çš„åˆ—è¡¨è§†å›¾æ·»åŠ æŒ‰é’®ï¼šå¯¹è±¡è¯¦æƒ…é¡µé¢é€‰æ‹©**é€‚ç”¨äºSalesforce Classicçš„æœç´¢å¸ƒå±€**ï¼Œé€‰æ‹©**åˆ—è¡¨è§†å›¾**ï¼Œç‚¹å‡»ç¼–è¾‘åå³å¯æ·»åŠ æŒ‰é’®



### å‘é‚®ä»¶

#### singleEmail(ç³»ç»Ÿå†…æ¨¡æ¿)

```java
public static void sendEmail(String ownFirstName,String conFirstName,String conLastName,String conCompanyName,String userEmail){
    System.debug('è¿›æ¥å‘é‚®ä»¶');
    EmailTemplate temp =  [
        SELECT Id, Name, Subject, HtmlValue, Body, BrandTemplateId
        FROM EmailTemplate
        WHERE DeveloperName = 'Existing_Dealer_Account_RSM'
        LIMIT 1
    ];
    // é‚®ä»¶å†…å®¹æ›¿æ¢ï¼Œä¾æ®{0},{1},{2}ä¾æ¬¡æ›¿æ¢
    String bodyFormat = String.format(temp.Body,new List<String>{ ownFirstName , conFirstName , conLastName , conCompanyName });
    List<Messaging.SingleEmailMessage> mailList = new List<Messaging.SingleEmailMessage>();
    Messaging.SingleEmailMessage mail = new Messaging.SingleEmailMessage();
    List<String> emalList = new List<String>();
    // æ”¶ä»¶äºº
    emalList.add(userEmail);     
    mail.setToAddresses(emalList);
    mail.setSenderDisplayName(null);
    mail.setTargetObjectId(UserInfo.getUserId());
    mail.setTreatTargetObjectAsRecipient(false);
    mail.setBccSender(true);
    mail.setSaveAsActivity(false);
    mail.setTemplateId(temp.Id);
    // é‚®ä»¶å†…å®¹ï¼Œå¦‚æ— æ›¿æ¢å†…å®¹ï¼Œå¯ä¸éœ€è¦
    mail.setPlainTextBody(bodyFormat);
    mailList.add(mail);
    try {
        Messaging.sendEmail(mailList);
    } catch (Exception e) {
        System.debug(e.getMessage());
    }
}
```

#### SingleEmailMessage(ä»£ç ç¼–å†™é‚®ä»¶å¸¦é™„ä»¶)

```java
 public static void sendEmail(Id recordId,String getemail){
     List<String> emaildetail=getemail.split(',');//å¤šä¸ªé‚®ä»¶åœ°å€ç”¨','éš”å¼€
     Pagereference page = new Pagereference('/apex/Post_Bid_MeetingPDF');
     Messaging.EmailFileAttachment attachment = new Messaging.EmailFileAttachment();
     //é‚®ä»¶å‘é€åˆ›å»ºemailåˆé›†
     List<Messaging.SingleEmailMessage> emails =new List<Messaging.SingleEmailMessage>();
     page.getParameters().put('id',recordId);
     Blob pdf = !Test.isRunningTest() ? page.getContentAsPDF() : Blob.valueOf('Fake content');
     attachment.setFileName('ä¼šè®®çºªè¦.pdf');
     attachment.setinline(false);
     attachment.setBody(pdf);
     String url=URL.getSalesforceBaseUrl().toExternalForm();
     String href=url+'/lightning/r/Minutes_Meeting__c/'+recordId+'/view';
     //ç»™ä¸åŒçš„äººå‘é‚®ä»¶
     for (String item : emaildetail) {
         Messaging.SingleEmailMessage emailInfo = new Messaging.SingleEmailMessage();
         emailInfo.setSubject('æœ‰å…³äºæ‚¨çš„æ‹›æ ‡é¡¹ç›®çš„æ ‡åä¼šè®®çºªè¦ï¼Œè¯·æŸ¥æ”¶ï¼');//é‚®ä»¶ä¸»é¢˜
         emailInfo.setSenderDisplayName('Salesforce ç³»ç»Ÿç®¡ç†å‘˜');
         emailInfo.setPlainTextBody('æœ‰å…³äºæ‚¨çš„æ‹›æ ‡é¡¹ç›®çš„æ ‡åä¼šè®®çºªè¦å·²åˆ›å»ºï¼Œè¯·è¿›å…¥ç³»ç»ŸæŸ¥çœ‹ã€‚' + '\n' + href);
         emailInfo.setBccAddresses(new List<String> {item});
         //emailInfo.setToAddresses(new List<String> {emailitem});

         emailInfo.setFileAttachments(new Messaging.EmailFileAttachment[] { attachment } );

         emails.add(emailInfo);
     }
     list<Messaging.SendEmailResult> emailResult =Messaging.sendEmail(emails);
     System.debug(emailResult);

 }
```

### ä¿å­˜PDFä¸ºé™„ä»¶

```java
public static void savePDF(Id recordId){
    try {
        Pagereference page = new Pagereference('/apex/Post_Bid_MeetingPDF');
        page.getParameters().put('id',recordId);
        Blob pdf = !Test.isRunningTest() ? page.getContentAsPDF() : Blob.valueOf('Fake content');

        Attachment attach = new Attachment(Name='æ ‡åä¼šè®®PDF'+Date.today().format()+'.pdf',body=pdf,ParentId=recordId);
        insert attach;
    } catch (VisualforceException e) {
        System.debug('error');
    }
}
```



### è·å–SFçš„è¿æ¥å¤´

```java
URL.getSalesforceBaseUrl().toExternalForm()

String url=URL.getSalesforceBaseUrl().toExternalForm();
String href=url+'/lightning/r/Minutes_Meeting__c/'+recordId+'/view';
```

### JSéç©ºæ£€æŸ¥

```javascript
// éç©ºæ£€æŸ¥JSæ–¹æ³•
isNotEmpty : function(obj){
    if(typeofÂ objÂ !==Â "undefined"Â &&Â objÂ !==Â nullÂ &&Â objÂ !==Â ""){
        returnÂ true;
    }else{
        returnÂ false;
    }
}
```

### æ ‡å‡†å¼‚æ­¥è°ƒç”¨

```js
checkTPP: function(cmp){
    var action = cmp.get("c.checkTPP");
    action.setParams({"TPP": cmp.get("{!v.TPPNumber}"), "FirstName": cmp.find("FirstName").get('v.value'), "LastName": cmp.find("LastName").get('v.value'), "Email": cmp.find("Email").get('v.value')});
    action.setCallback(this, function(response) {
        var state = response.getState();
        if (state === "SUCCESS") {
            var result = response.getReturnValue();
            console.log(result);
            // å›è°ƒæ“ä½œ
            
        }
        else if (state === "INCOMPLETE") {
            // ä»£ç æ¡©
        }
        else if (state === "ERROR") {
            var errors = response.getError();
            if (errors) {
                if (errors[0] && errors[0].message) {
                    console.log("Error message: " + errors[0].message);
                }
            } else {
                console.log("Unknown error");
            }
        }
    });
    $A.enqueueAction(action);
}
```

### æµ‹è¯•ç±»ä¹¦å†™

```java
@isTest
public class SaleLeadImportCtrTest{

    @isTest
    private static void testMethod(){
        String str1 = '[{"å®¢æˆ·åç§°*":"ä¸­å›½çŸ³åŒ–1","åˆ†é”€å•†ä»£ç *":3013,"ç”µå­é‚®ä»¶":"mail@mail.com","çœä»½":"æµ™æ±Ÿ","åŸå¸‚":"åˆè‚¥"},{"å®¢æˆ·åç§°*":"ä¸­å›½çŸ³åŒ–2","åˆ†é”€å•†ä»£ç *":3013,"ç”µå­é‚®ä»¶":"yun","çœä»½":"æµ™æ±Ÿ","åŸå¸‚":"è¡¢å·"},{"å®¢æˆ·åç§°*":22,"åˆ†é”€å•†ä»£ç *":77,"å§“å":"name3","ç”µå­é‚®ä»¶":"mail@mail.com","çœä»½":"æµ™æ±Ÿ","åŸå¸‚":"æ­å·"}]';

        Test.startTest();
        SaleLeadImportCtr.insertData(str1);
        Test.stopTest();
    }
}
```

### è·å–RecordTypeId

```java
Id RTId = Schema.SObjectType.Account.getRecordTypeInfosByDeveloperName().get('Distributor').getRecordTypeId();
System.debug(RTId);
```

Schema.SObjectType.å¯¹è±¡.getRecordTypeInfosByDeveloperName().get('è®°å½•ç±»å‹çš„**DeveloperName**').getRecordTypeId();

### Schemaç”¨æ³•

+ #### getGlobalDescribe()

```java
Map<String, Schema.SObjectType> gd = Schema.getGlobalDescribe();
```

æ‰€æœ‰å¯¹è±¡(sObject)çš„names(keys) and tokens(values)

+ #### describeSObjects(sObjectTypes)

```java
Schema.DescribeSObjectResult[] Results = Schema.describeSObjects(new String[]{'Account','opportunity'});
```

This method returns a list of fields and properties of a particular sObject or array of sObjects.

+ ####  describeDataCategoryGroups(sObjectNames)

```java
public static List<Schema.DescribeDataCategoryGroupResult> describeDataCategoryGroups(List<String> sObjectNames)
```



This method is used to return a list of categorized groups linked with a particular object or specified object.

+ #### describeTabs()

```java
Schema.DescribeTabSetResult[] tabInfo = Schema.describeTabs();
```

This method is used to return information about **Custom and Standard apps** available to current users.

### è·å–é€‰é¡¹åˆ—è¡¨å€¼

```java
// è·å–é€‰é¡¹åˆ—è¡¨å€¼<value,label>
public static Map<String,String> getPicklistValuesMap(String sObjectName, String sFieldName){
    Map<String,String> picValues=new Map<String,String>();
    if(Schema.getGlobalDescribe().containsKey(sObjectName)){
        Map<String,Schema.SobjectField> sObjectFieldsMap=Schema.getGlobalDescribe().get(sObjectName).getDescribe().fields.getMap();
        if(sObjectFieldsMap.containsKey(sFieldName)){
            for(Schema.PicklistEntry picklistEntry : sObjectFieldsMap.get(sFieldName).getDescribe().getPicklistValues()){
                picValues.put(picklistEntry.getValue(),picklistEntry.getLabel());
            }
        }
    }
    return picValues;
}
```

```java
// æ£€æŸ¥é€‰é¡¹åˆ—è¡¨èŒƒå›´,å•é€‰
System.debug(saleLead.Province__c);
if(saleLead.Province__c != null){
    Map<String,String> ProvinceValue = getPicklistValuesMap('saleLead__c','Province__c');
    boolean BProvinceValue = ProvinceValue.containsKey(saleLead.Province__c);
    if(BProvinceValue==false){errorMsg += 'çœä»½å¡«å†™ä¸æ­£ç¡®,';}
}
```

```java
// å¤šé€‰
if(saleLead.IC__c != null){
    System.debug(saleLead.IC__c);
    Map<String,String> ICValue = getPicklistValuesMap('saleLead__c','IC__c');
    String SIC = saleLead.IC__c;
    String[] S1 = SIC.split(';');
    for(String item:S1){
        Boolean BS1 = ICValue.containsKey(item);
        if(BS1==false){errorMsg += 'ICå¡«å†™ä¸æ­£ç¡®,';}
    }
}
```



### Toastæç¤º

```java
//Toastæç¤º
showTheToast : function(theTitle, theMessage, theType) {
    var toastEvent = $A.get("e.force:showToast");
    toastEvent.setParams({
        "title": theTitle,
        "message": theMessage,
        type : theType
    });
    toastEvent.fire();
}
```

### å…³é—­ç»„ä»¶

```java
// å…³é—­lightningç»„ä»¶
closeModel : function (cmp) {
    let close = $A.get("e.force:closeQuickAction");
    close.fire();
}
```

### é€‰é¡¹åˆ—è¡¨ä¾èµ–å…³ç³»

```java
// åŸå¸‚DependMap
Map<String,List<String>> dependMap = new Map<String,List<String>>();
List<DependentPicklistController.PicklistValue> SPC = DependentPicklistController.getPicklistValues('SaleLead__c', 'Province__c', 'City__c');
System.debug(SPC);
for(DependentPicklistController.PicklistValue item:SPC){
    List<DependentPicklistController.PicklistValue> PList= new List<DependentPicklistController.PicklistValue>();
    if(item.dependents != null){
        PList = item.dependents;
        System.debug('!!!!!'+PList);
        List<String> itemList = new List<String>();
        for(DependentPicklistController.PicklistValue item2:PList){
            if(item2.label != null && item2.label.length()>0){
                String labelList = item2.label;
                itemList.add(labelList);
            }
        }
        String key = item.label;
        dependMap.put(key, itemList);
    }
}
System.debug(dependMap);
```

```java
/**
 * @description       : ä¾èµ–å…³ç³»é€‰é¡¹åˆ—è¡¨æŸ¥è¯¢
 * @author            : robert
 * @group             : dcit-hf
 * @last modified on  : 09-27-2021
 * @last modified by  : robert
**/
public with sharing class DependentPicklistController {
    @AuraEnabled //(cacheable = true)
    public static Map<String, List<PicklistValue>> getMutiPicklistValues(
      String objApiName,
      Map<String, String> dependentFieldsMap
    ) {
      System.debug(dependentFieldsMap);
      Map<String, List<PicklistValue>> returnMap = new Map<String, List<PicklistValue>>();
      for (String key : dependentFieldsMap.keySet()) {
        String key2 = dependentFieldsMap.get(key);
        //for(String key2 :dependentFieldsMap.get(key).keySet()){
        returnMap.put(key, getPicklistValues(objApiName, key2, key));
        //}
      }
      return returnMap;
    }
    @AuraEnabled //(cacheable = true)
    public static List<PicklistValue> getPicklistValues(
      String objApiName,
      String controlField,
      String dependentField
    ) {
      List<PicklistValue> pickListValues = new List<PicklistValue>();
      if (
        String.isBlank(objApiName) ||
        String.isBlank(controlField) ||
        String.isBlank(dependentField)
      ) {
        //return pickListValues;
        objApiName = 'Account';
        controlField = 'Country__c';
        dependentField = 'State__c';
        //enable the return statement and remove the above static assignment with some valid error value to update the UI
        //return;
      }
  
      //Identify the sobject type from the object name using global schema describe function
      Schema.SObjectType targetType = Schema.getGlobalDescribe().get(objApiName);
      //Create an empty object based up on the above the sobject type to get all the field names
      Schema.sObjectType objType = targetType.newSObject().getSobjectType();
      //fetch the all fields defined in the sobject
      Map<String, Schema.SObjectField> objFieldMap = objType.getDescribe()
        .fields.getMap();
      //Get the controlling and dependent picklist values from the objFieldMap
      List<Schema.PicklistEntry> controlledPLEntries = objFieldMap.get(
          controlField
        )
        .getDescribe()
        .getPicklistValues();
      List<Schema.PicklistEntry> dependentPLEntries = objFieldMap.get(
          dependentField
        )
        .getDescribe()
        .getPicklistValues();
  
      // Wrap the picklist values using custom wrapper class â€“ PicklistValue
      for (Schema.PicklistEntry entry : controlledPLEntries) {
        PicklistValue picklistValue = new PicklistValue(
          entry.isActive(),
          entry.isDefaultValue(),
          entry.getLabel(),
          entry.getValue()
        );
        pickListValues.add(picklistValue);
      }
      //ValidFor is an indicator value for the controlling field which is base64 encrypted
      //base64 value should be convered to 6bit grouped binary and 1 indicate the controlling field in a certain order
      //Also,validFor value only be shown when it is serialized so it should be serialized then deserialized using PicklistValue wrapper class
      for (PicklistValue plVal : deserializePLEntries(dependentPLEntries)) {
        String decodedInBits = base64ToBits(plVal.validFor);
  
        for (Integer i = 0; i < decodedInBits.length(); i++) {
          // For each bit, in order: if it's a 1, add this label to the dependent list for the corresponding controlling value
          String bit = decodedInBits.mid(i, 1);
          if (bit == '1') {
            PicklistValue dependentPLValue = new PicklistValue(
              plVal.active,
              plVal.defaultValue,
              plVal.label,
              plVal.value
            );
            //Dependent picklist value is mapped to its parent controlling value through 'dependents' attribute in the PicklistValue wrapper class
            if (pickListValues.get(i).dependents == null) {
              pickListValues.get(i).dependents = new List<PicklistValue>{
                dependentPLValue
              };
            } else {
              pickListValues.get(i).dependents.add(dependentPLValue);
            }
          }
        }
      }
      System.debug(pickListValues);
      return pickListValues;
    }
  
    private static List<PicklistValue> deserializePLEntries(
      List<Schema.PicklistEntry> plEntries
    ) {
      return (List<PicklistValue>) JSON.deserialize(
        JSON.serialize(plEntries),
        List<PicklistValue>.class
      );
    }
    //Available base64 charecters
    private static final String BASE_64_CHARS =
      '' +
      'ABCDEFGHIJKLMNOPQRSTUVWXYZ' +
      'abcdefghijklmnopqrstuvwxyz' +
      '0123456789+/';
  
    // Convert decimal to binary representation (alas, Apex has no native method ğŸ™
    //    eg. 4 => '100', 19 => '10011', etc.
    // Method: Divide by 2 repeatedly until 0. At each step note the remainder (0 or 1).
    // These, in reverse order, are the binary.
    private static String decimalToBinary(Integer val) {
      String bits = '';
      while (val > 0) {
        Integer remainder = Math.mod(val, 2);
        val = Integer.valueOf(Math.floor(val / 2));
        bits = String.valueOf(remainder) + bits;
      }
      return bits;
    }
  
    // Convert a base64 token into a binary/bits representation
    // e.g. 'gAAA' => '100000000000000000000'
    private static String base64ToBits(String validFor) {
      if (String.isEmpty(validFor)) {
        return '';
      }
  
      String validForBits = '';
  
      for (Integer i = 0; i < validFor.length(); i++) {
        String thisChar = validFor.mid(i, 1);
        Integer val = BASE_64_CHARS.indexOf(thisChar);
        String bits = decimalToBinary(val).leftPad(6, '0');
        validForBits += bits;
      }
  
      return validForBits;
    }
  
    //Wrapper class
  
    public class PicklistValue {
      @AuraEnabled
      public Boolean active { get; set; }
      @AuraEnabled
      public Boolean defaultValue { get; set; }
      @AuraEnabled
      public String label { get; set; }
      @AuraEnabled
      public String validFor { get; set; }
      @AuraEnabled
      public String value { get; set; }
  
      @AuraEnabled
      public List<PickListValue> dependents { get; set; }
  
      public PicklistValue() {
      }
  
      public PicklistValue(
        Boolean active,
        Boolean defaultValue,
        String label,
        String validFor,
        String value
      ) {
        this.active = active;
        this.defaultValue = defaultValue;
        this.label = label;
        this.validFor = validFor;
        this.value = value;
      }
  
      public PicklistValue(
        Boolean active,
        Boolean defaultValue,
        String label,
        String value
      ) {
        this.active = active;
        this.defaultValue = defaultValue;
        this.label = label;
        this.validFor = validFor;
        this.value = value;
      }
  
      public PicklistValue(String label, String value) {
        this.label = label;
        this.value = value;
      }
    }
  }
```

```java
/**
 * @description       : ä¾èµ–å…³ç³»é€‰é¡¹åˆ—è¡¨æŸ¥è¯¢æµ‹è¯•ç±»
 * @author            : robert
 * @group             : dcit-hf
 * @last modified on  : 09-08-2021
 * @last modified by  : robert
**/
@isTest
public class DependentPicklistControllerTest{
    @isTest
    private static void getPicklistValues_Test(){
        Test.startTest();
        DependentPicklistController.getPicklistValues('SaleLead__c', 'Province__c', 'City__c');
        Test.stopTest();
    }
}
```

### ä»¿åŸç”Ÿç»„ä»¶æ ·å¼

```html
<aura:html tag="style">
    .cuf-content {
    padding: 0 0rem !important;
    }
    .slds-p-around--medium {
    padding: 0rem !important;
    }
    .slds-modal__content{
    overflow-y:hidden !important;
    height:unset !important;
    max-height:unset !important;
    }
    .slds-modal__container {
    width : 50% !important;
    max-width : 50% !important;
    }
</aura:html>
```

### æäº¤å®¡æ‰¹

```java
Approval.ProcessSubmitRequest psr = new Approval.ProcessSubmitRequest();
psr.objectId = newQuo.Id;// å¾…å®¡æ‰¹å¯¹è±¡Id
psr.setProcessDefinitionNameOrId('AMPRequote');// æŒ‡å®šæ‰¹å‡†è¿‡ç¨‹ï¼ˆå¯ä¸æŒ‡å®šï¼‰
psr.setSubmitterId(newQuo.OwnerId);// æäº¤è€…Id
system.debug('psr' + psr);
if(!Test.isRunningTest())Approval.ProcessResult result = Approval.process(psr);
```

### lightningé¡µé¢åˆ·æ–°

```js
$A.get('e.force:refreshView').fire();
```

### æŸ¥æ‰¾å­—æ®µLabelï¼ˆç¿»è¯‘ï¼‰

```java
select Id,Name,toLabel(Address) FROM Account
```

### æ–°å»ºè®°å½•ç»„ä»¶ï¼Œé˜»æ­¢è·³è½¬

```js
var createRecordEvent = $A.get("e.force:createRecord");
createRecordEvent.setParams({
    "entityApiName": "Contact",
    "defaultFieldValues": {
        "AccountId": result.AccountId,
        "RMA_Contact__c": cmp.get("{!v.recordId}"),
        "Country__c": result.Country,
        "ContactState__c": result.State,
        "City__c": result.City,
        "County__c": result.County,
        "Street__c": result.Street,
        "Zip_Code__c": result.ZipCode
    },
    "recordTypeId": result.RecordTypeId,
    //é˜»æ­¢åˆ›å»ºä¹‹åè·³è½¬åˆ°è¯¦ç»†é¡µé¢
    "navigationLocation": "LOOKUP",
    "panelOnDestroyCallback": function(event) {
    }
});
createRecordEvent.fire();
```

### åˆ·æ–°Lightingé¡µé¢ï¼Œå…³é—­Lightingç»„ä»¶

```js
$A.get('e.force:refreshView').fire();
$A.get("e.force:closeQuickAction").fire();
```

### Lightingè®°å½•é¡µé¢é‡å®šå‘ï¼Œ

```js
var navEvt = $A.get("e.force:navigateToSObject");
navEvt.setParams({
	"recordId": cmp.get("{!v.recordId}")
	"slideDevName": "related"
});
navEvt.fire();
```

### å¼ºåˆ¶åˆ·æ–°é¡µé¢

```js
window.location.reload(true);
```

### PDFæ–‡æœ¬åŒºåŸŸæ¢è¡Œ

```java
public static string creatHuanhang(string sources,integer count){
    string temp='';
    //count=20;//æ¯è¡Œæ˜¾ç¤ºçš„å­—æ•°ï¼Œç°è®¾ä¸º6ï¼Œæ ¹æ®éœ€è¦è®¾ç½®
    if(sources!=null&&sources.length()!=0 &&sources.length()>count){
        integer si=sources.length()/count;  
        for(integer i=0;i<si;i++){
            temp+=sources.substring(i*count,i*count+count)+' ';
        }
        if(sources.length()-si*count>0){
            temp+=sources.substring(si*count, sources.length())+' ';
        }
        System.debug('TEST========'+temp);
        return temp;
    }
    return sources;
}
```

### æ•°å­—æ˜¾ç¤ºä¸¤ä½å°æ•°

```html
<th valign="top" width="11%"><apex:outputText value="${0, number, ###,###,###,###,##0.00}"><apex:param value="{!itemo.TotalPrice}" /></apex:outputText></th>
```

### æ“ä½œæ ·å¼å¸ƒå±€åŠ¨æ€è°ƒæ•´ï¼ˆé€šè¿‡æ˜¯å¦å±•ç¤ºæ ·å¼å‚æ•°æ¥æ§åˆ¶ï¼‰

```html
<aura:if isTrue="{!v.isAMP}">
		<aura:html tag="style">
			.slds-modal__container {
			width : 45% ;
			max-width : 100% !important;
			height : 100% !important;
			}
			.slds-modal__content{
			overflow-y:hidden !important;
			height:unset !important;
			max-height:unset !important;
			}
		</aura:html>
	</aura:if>
```

### ç³»ç»Ÿå†…éƒ¨æ•°æ®è¿ç§»

ä¹Ÿå¯ç”¨äºæ•°æ®åˆ›å»ºåšå‚è€ƒ

```java
// æ ¹æ®å·²è¿ç§»çš„Accountæ¥æŸ¥æ‰¾éœ€è¦è¿ç§»çš„Commission_And_Service_Agreement__cå¯¹è±¡
List<Account> newAccountList= [select Id,Company_Code__c,isImport__c,oldAccount__c from Account where Company_Code__c = '1280' and isImport__c = true];
// Map<oldId,Id>
Map<String,String> accMap = new Map<String,String>();
for(Account acc:newAccountList){
    accMap.put(acc.oldAccount__c, acc.Id);
}
System.debug(accMap.size());
Set<String> oldAcoountIdSet = accMap.KeySet();
// è·å–æ‰€æœ‰å­—æ®µ
Map<String, Schema.SObjectField> fieldMap = Schema.SObjectType.Commission_And_Service_Agreement__c.fields.getMap();
System.debug(fieldMap);
String sql = 'select ';
for(String key : fieldMap.keySet()){
    sql += key+',';
}
sql = sql.substring(0, sql.length()-1);
sql += ' From Commission_And_Service_Agreement__c WHERE Commission_And_Service_Account__c IN: oldAcoountIdSet';
List<Commission_And_Service_Agreement__c> oldObjectList = Database.query(sql);
List<Commission_And_Service_Agreement__c> newObjectList = new List<Commission_And_Service_Agreement__c>();
// æ‰€æœ‰éœ€è¦åŒæ­¥çš„å¯¹è±¡
System.debug(oldObjectList.size());
for(Commission_And_Service_Agreement__c item:oldObjectList){
    Commission_And_Service_Agreement__c newObj = item.clone();
    newObj.oldRecord__c = item.Id;
    newObj.isImport__c = true;
    // Important!!
    newObj.Commission_And_Service_Account__c = accMap.get(item.Commission_And_Service_Account__c);
    newObjectList.add(newObj);
}
System.debug(newObjectList);

List<Database.SaveResult> ceretedResultList =  Database.insert(newObjectList,false);
Integer i =0;
Set<String> accIdSet = new Set<String>();
for(Database.SaveResult res :  ceretedResultList){
    if(!res.isSuccess()){
        System.debug('Insert Faild:this is oldRecordId: ' + newObjectList[i].oldRecord__c);
        System.debug(res.getErrors());
    }
    i++;
}


// å¤„ç†æ–°ç”Ÿæˆå¯¹è±¡é—´çš„æŸ¥æ‰¾å…³ç³»
List<Commission_And_Service_Agreement__c> createdObjectList = [SELECT Id,oldRecord__c,isImport__c,afterCommission__c,BeforeCommission__c FROM Commission_And_Service_Agreement__c WHERE isImport__c = true];
// å¯¹è±¡é—´å­˜åœ¨æŸ¥æ‰¾å…³ç³»<oldId,newId>
Map<String,String> newObjectLookupMap = new Map<String,String>();
newObjectLookupMap.put('','');
for(Commission_And_Service_Agreement__c newObj:createdObjectList){
    newObjectLookupMap.put(newObj.oldRecord__c, newObj.Id);
}
for(Commission_And_Service_Agreement__c newObj:createdObjectList){
    newObj.afterCommission__c = newObjectLookupMap.get(newObj.afterCommission__c);
    newObj.BeforeCommission__c = newObjectLookupMap.get(newObj.BeforeCommission__c);
}
update createdObjectList;
```
